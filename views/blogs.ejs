<%- include("partials/header.ejs") %>

<section class="content py-5">
    <div class="container">
        <div class="row g-4 m-2">
            <% locals.data.forEach((element, i) => { %>
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100 border-0 shadow ">
                        <div class="card-body d-flex flex-column px-3">
                            <h5 class="card-title text-center mb-3">
                                <a class="bloglink" href="/blog<%= i %>"><%= element.title %></a>
                            </h5>
                            <div class="card-text overflow-auto" style="max-height: 200px;">
                                <p>
                                    <%= element.blogcontent %>
                                </p>
                            </div>
                            <div class="m-auto mb-2 ">
                                <button class="btn btn-secondary btn-sm " data-id="<%= i %>">
                                    Edit
                                </button>
                                <button class="btn btn-danger btn-sm delete-btn" data-id="<%= i %>">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
</section>

<script>
    document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", function () {
            const id = this.dataset.id;
            if (confirm("Are you sure you want to delete this blog?")) {
                fetch(`/delete/${id}`, { method: "DELETE" })
                    .then(response => {
                        if (response.ok) {
                            alert("Blog deleted successfully");
                            location.reload(); 
                        } else {
                            alert("Failed to delete blog");
                        }
                    })
                    .catch(err => console.error("Error:", err));
            }
        });
    });
</script>

<%- include("partials/footer.ejs") %>